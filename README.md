# KBond Messenger 실시간 메시지 추출 프로그램

KBond 메신저의 대화 내용을 실시간으로 감지하여 텍스트 파일로 저장하는 전문 모니터링 도구입니다. Win32 API를 직접 활용하여 카카오톡 대비 더 안정적이고 정교한 텍스트 추출을 지원합니다.

## 🚀 주요 기능

- ⚡ **Win32 API 직접 연동**: 클립보드나 UI Automation 대신 `WM_GETTEXT`를 직접 호출하여 빠르고 정확하게 텍스트 추출
- 🔍 **실시간 다중 창 감지**: 프로그램 실행 중 새로운 채팅방이 열려도 자동으로 인식 및 모니터링 시작
- 🛡️ **입력창 자동 제외**: 사용자가 입력창에 타이핑 중인 내용은 무시하고, 실제 전송된 대화 내용만 선별하여 저장
- 📁 **방 이름별 로깅**: 저장 시 `[방이름]` 태그를 자동으로 붙여 여러 대화방의 내용을 한 파일에서 쉽게 구분
- 🌘 **백그라운드 지원**: 채팅창이 다른 창에 가려져 있거나 최소화되지 않은 상태라면 백그라운드에서도 인식 가능

## 📋 시스템 요구사항

- **OS**: Windows 10/11
- **Python**: 3.8 이상
- **KBond**: 설치 및 로그인 된 상태
- **필수 패키지**: `pywin32`, `psutil`

## 🔧 설치 방법

### 1. Python 패키지 설치

```bash
pip install -r requirements.txt
```

### 2. 설정 확인 (`config.json`)

`kbond` 섹션을 통해 모니터링 간격을 조정할 수 있습니다:

```json
{
  "kbond": {
    "monitoring_interval": 0.5
  },
  "output": {
    "directory": "output",
    "filename_format": "kbond_messages_{timestamp}.txt",
    "append_mode": true,
    "encoding": "utf-8"
  }
}
```

## 📖 사용 방법

### 프로그램 실행

```bash
python kbond_main.py
```

### 작동 순서

1. **KBond 실행**: 모니터링할 KBond 메신저를 실행하고 로그인합니다.
2. **대화방 열기**: 모니터링하려는 대화방들을 엽니다. (실행 중에 열어도 무관)
3. **프로그램 시작**: `kbond_main.py`를 실행하면 열려 있는 모든 대화방을 자동으로 찾아 모니터링을 시작합니다.
4. **결과 확인**: `output` 폴더에 생성된 텍스트 파일에서 실시간으로 기록되는 메시지를 확인합니다.

## 📂 프로젝트 구조

```
messenger_reading/
├── src/
│   ├── kbond_monitor.py      # Win32 API 기반 추출 및 중복 제거 로직
│   ├── message_writer.py     # 비동기 파일 쓰기 엔진
│   └── ...                   # 기타 유틸리티 파일
├── output/                   # 추출된 메시지가 저장되는 폴더
├── config.json               # 통합 설정 파일
├── kbond_main.py             # KBond 전용 메인 실행 파일
├── requirements.txt          # Python 의존성 라이브러리
└── README.md
```

## 🔍 작동 원리

### 1. Win32 API 핸들링
- `EnumWindows`와 `EnumChildWindows`를 사용하여 KBond의 채팅창(`TfrmDccChat`)을 식별합니다.
- `RichEdit` 컨트롤에 `WM_GETTEXT` 메시지를 보내 텍스트를 직접 읽어옵니다.

### 2. 스마트 필터링
- **ReadOnly 체크**: 읽기 전용 속성이 있는 컨트롤만 추출하여 사용자의 입력창 타이핑 내용은 제외합니다.
- **높이 분석**: 여러 컨트롤 중 높이가 가장 큰 대역을 대화 내역창으로 판단합니다.
- **Deduplication**: 메시지별 해시값을 비교하여 이미 저장된 내용은 중복 기록하지 않습니다.

### 3. 유연한 줄바꿈 처리
- `splitlines()`를 사용하여 Windows(`\r\n`)와 Unix(`\n`) 형식이 혼재된 환경에서도 완벽하게 줄을 분리합니다.

## ⚠️ 주의사항

- **보안**: 금융 거래 관련 메시지가 포함될 수 있으므로 출력 파일의 보안에 각별히 유의하세요.
- **법적 고지**: 타인의 대화를 무단으로 수집하거나 저장하는 행위는 관련 법령에 의해 처벌받을 수 있습니다. 반드시 허가된 용도로만 사용하십시오.
- **성능**: 너무 많은 대화방(50개 이상)을 동시에 모니터링할 경우 시스템 부하가 발생할 수 있습니다.

## 🔄 향후 개선 계획

- [ ] 특정 키워드 감지 시 텔레그램/슬랙 알림 전송
- [ ] 엑셀(CSV) 형식 저장 지원
- [ ] 과거 내역 제외 옵션 추가
